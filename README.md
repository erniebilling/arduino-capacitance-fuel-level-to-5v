# Dual Tank Capacitive Fuel Sender for RV-7 Aircraft
## 555 Timer + Arduino + PWM Output Design

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Platform: Arduino](https://img.shields.io/badge/Platform-Arduino-blue.svg)](https://www.arduino.cc/)

---
*NOTE: This is the original as generated by Claude Sonnet 4.5. As I assemble and test, I will update. Most of the changes I foresee involve parts and power. For instance, I plan to use an [Arduino Nano R4]( https://store-usa.arduino.cc/collections/nano-family/products/nano-r4-with-headers) which operates on 6-21v and hopefully won't require the power supply circuit - EB.*

---

## Table of Contents

- [Overview](#overview)
- [Features](#features)
- [System Architecture](#system-architecture)
- [How It Works](#how-it-works)
- [Hardware Requirements](#hardware-requirements)
- [Circuit Design](#circuit-design)
- [Software Design](#software-design)
- [Assembly Instructions](#assembly-instructions)
- [Calibration](#calibration)
- [Testing](#testing)
- [Troubleshooting](#troubleshooting)
- [Performance Specifications](#performance-specifications)
- [Safety Considerations](#safety-considerations)
- [License](#license)

---

## Overview

This project implements a **dual-tank capacitive fuel level sender** for experimental aircraft (specifically designed for RV-7, but adaptable to other aircraft). It converts capacitance from fuel probes into clean 0-5V analog signals suitable for aircraft EFIS systems like the Dynon D120.

The design uses proven, simple technology:
- **555 timer circuits** to convert capacitance to frequency
- **Arduino Nano** for frequency measurement and processing
- **PWM + RC filters** to generate 0-5V analog outputs
- **Button-based calibration** for easy field adjustment

**Total cost: ~$25-30** (vs $200-500 for commercial units)

### Design Philosophy

This is a **K.I.S.S. design** (Keep It Simple, Stupid):
- Uses time-proven 555 timer technology (in use since 1972)
- All through-hole components (no SMD soldering required)
- Software calibration (no potentiometers to adjust)
- Simple PWM output (no expensive DACs needed)
- Minimal parts count (easier to build, debug, and maintain)

Perfect for homebuilders who want reliable fuel indication without breaking the bank!

---

## Features

### Core Capabilities
✅ **Dual independent tanks** - Simultaneous monitoring of left and right tanks  
✅ **Direct frequency-to-voltage conversion** - No fuel capacity calculations needed  
✅ **Button calibration** - No opening enclosure to adjust  
✅ **Non-volatile storage** - Calibration saved in EEPROM  
✅ **Wide capacitance range** - Handles 50 pF to 5000 pF (typical probes: 150-600 pF)  
✅ **High resolution** - 256 steps (0.078 gallon resolution for 20-gal tank)  
✅ **Low power** - < 50mA total draw  

### Safety Features
✅ **Proven 555 timer design** - Used in thousands of aircraft  
✅ **No mechanical adjustments** - Nothing to vibrate loose  
✅ **Filtered outputs** - Clean DC voltage to EFIS  
✅ **Protected inputs** - Current-limited connections  
✅ **Status LED** - Visual confirmation of operation  

### Practical Features
✅ **Tank selector** - One set of buttons calibrates both tanks  
✅ **Serial monitoring** - Real-time debugging via USB  
✅ **Averaging filter** - Smooth readings despite fuel slosh  
✅ **Simple wiring** - Minimal connections to aircraft  

---

## System Architecture

### Block Diagram

```
┌──────────────┐                    ┌─────────────────────┐
│  LEFT TANK   │                    │                     │
│  Fuel Probe  │──────RG174────────►│  555 Timer #1       │
│  (150-600pF) │    Coax Cable      │  (Capacitance to    │
└──────────────┘                    │   Frequency)        │
                                    │  Output: 15-70 kHz  │
                                    └──────────┬──────────┘
                                               │
┌──────────────┐                    ┌─────────▼──────────┐
│  RIGHT TANK  │                    │                     │
│  Fuel Probe  │──────RG174────────►│  555 Timer #2       │
│  (150-600pF) │    Coax Cable      │  (Capacitance to    │
└──────────────┘                    │   Frequency)        │
                                    │  Output: 15-70 kHz  │
                                    └──────────┬──────────┘
                                               │
                    ┌──────────────────────────┴──────────┐
                    │                                     │
                    │        ARDUINO NANO                 │
                    │                                     │
                    │  • Frequency measurement (Pins 2,3) │
                    │  • Calibration (EEPROM storage)     │
                    │  • Averaging & filtering            │
                    │  • PWM generation (Pins 9,10)       │
                    │  • Button interface (Pins 4,5,6)    │
                    │                                     │
                    └──────────┬──────────┬───────────────┘
                               │          │
                    ┌──────────▼─┐    ┌──▼────────────┐
                    │ RC Filter  │    │  RC Filter    │
                    │ (1kΩ+10µF) │    │  (1kΩ+10µF)   │
                    └──────────┬─┘    └──┬────────────┘
                               │          │
                    ┌──────────▼─┐    ┌──▼────────────┐
                    │  Dynon     │    │   Dynon       │
                    │  Left Fuel │    │   Right Fuel  │
                    │  Input     │    │   Input       │
                    │  (0-5V)    │    │   (0-5V)      │
                    └────────────┘    └───────────────┘
```

### Signal Flow

**Left Tank Path:**
```
Fuel Level → Capacitance Change → 555 Frequency → Arduino Counter → 
PWM Output → RC Filter → Clean 0-5V DC → Dynon Left Input
```

**Right Tank Path:**
```
Fuel Level → Capacitance Change → 555 Frequency → Arduino Counter → 
PWM Output → RC Filter → Clean 0-5V DC → Dynon Right Input
```

---

## How It Works

### The Complete Process

#### 1. Capacitance Sensing (Fuel Probe)

The fuel probe is a capacitor with two concentric tubes:

```
Cross-section of fuel probe:

    [Inner tube - Signal]
         |  |
         |  | <-- Gap filled with air or fuel
         |  |
    [Outer tube - Ground to tank body]
```

**Capacitance changes with fuel level:**
```
Empty tank:
  Gap filled with air (permittivity ≈ 1.0)
  Capacitance ≈ 150-200 pF

Full tank:
  Gap filled with fuel (permittivity ≈ 2.0)
  Capacitance ≈ 550-650 pF
  
Fuel has 2× the permittivity of air,
so capacitance roughly doubles when submerged!
```

#### 2. Capacitance-to-Frequency Conversion (555 Timer)

The 555 timer oscillates at a frequency determined by the probe capacitance:

```
Circuit topology:

+5V──[R1 10kΩ]──┬──[R2 100kΩ]──[Fuel Probe]──GND
                │
            555 Timer
          (Pins 2,6,7)
                │
             Output
          (Square wave)
```

**How the 555 works:**

1. **Charging phase:** Capacitor charges through R1+R2 from 1.67V to 3.33V
2. **Threshold reached:** 555 detects 3.33V, switches to discharge mode
3. **Discharging phase:** Capacitor discharges through R2 from 3.33V to 1.67V
4. **Trigger reached:** 555 detects 1.67V, switches to charge mode
5. **Repeat forever!**

**The frequency formula:**
```
f = 1.44 / [(R1 + 2×R2) × C]
f = 1.44 / [210,000Ω × C]

Empty tank (200 pF):
f = 1.44 / (210,000 × 200×10⁻¹²) = 34,286 Hz ≈ 34 kHz

Full tank (600 pF):
f = 1.44 / (210,000 × 600×10⁻¹²) = 11,429 Hz ≈ 11 kHz

Frequency change: 23 kHz (excellent resolution!)
```

**Why this works:**
- Higher capacitance → Takes longer to charge/discharge → Lower frequency
- Lower capacitance → Charges/discharges faster → Higher frequency
- Linear relationship makes calibration simple!

#### 3. Frequency Measurement (Arduino)

The Arduino counts pulses using hardware interrupts:

```cpp
// Interrupt Service Routine
void countLeftPulse() {
  leftPulseCount++;
}

// In setup()
attachInterrupt(digitalPinToInterrupt(LEFT_FREQ_PIN), countLeftPulse, RISING);

// Every second, calculate frequency
leftFrequency = leftPulseCount;  // Pulses per second = Hz
leftPulseCount = 0;  // Reset for next second
```

**Measurement process:**
1. Count rising edges on pin 2 (left) and pin 3 (right)
2. Every 1 second, frequency = pulse count
3. Average last 10 samples for smooth reading
4. Convert frequency to PWM value

**Why interrupts?**
- Hardware-driven (doesn't miss pulses)
- Accurate timing (not affected by other code)
- Can handle two frequencies simultaneously

#### 4. Frequency-to-Voltage Conversion (Software)

The Arduino maps frequency to PWM value (0-255):

```cpp
uint8_t frequencyToPWM(float frequency, TankCalibration tank) {
  // Constrain to calibrated range
  if (frequency >= tank.emptyFrequency) return 0;    // 0V
  if (frequency <= tank.fullFrequency) return 255;   // 5V
  
  // Linear interpolation
  float fraction = (tank.emptyFrequency - frequency) / 
                   (tank.emptyFrequency - tank.fullFrequency);
  
  // fraction = 0.0 (empty) to 1.0 (full)
  // Convert to PWM: 0 to 255
  return (uint8_t)(fraction * 255.0);
}
```

**Example:**
```
Left tank calibration:
  Empty: 34,000 Hz → PWM 0 (0V)
  Full: 11,000 Hz → PWM 255 (5V)

Current reading: 22,500 Hz

Calculation:
  fraction = (34000 - 22500) / (34000 - 11000)
  fraction = 11500 / 23000 = 0.5
  
  PWM = 0.5 × 255 = 127 (approximately 2.5V)
  
Tank is half full!
```

#### 5. PWM-to-Analog Conversion (RC Filter)

A simple RC filter converts PWM to clean DC voltage:

```
Arduino Pin 9/10 (PWM)
    |
   [R] 1kΩ
    |
    +──[C] 10µF──GND
    |
   Output (0-5V DC)
```

**How it works:**

PWM is a square wave that's ON for a fraction of the time:
```
0% duty cycle (PWM=0):
  Always LOW → 0V average

50% duty cycle (PWM=127):
  ▄▄▄  ▄▄▄  ▄▄▄
  ▌ ▀▀▀▌ ▀▀▀▌ ▀▀  → 2.5V average

100% duty cycle (PWM=255):
  Always HIGH → 5V average
```

The RC filter smooths this into clean DC:
```
Time constant: τ = R × C = 1kΩ × 10µF = 10ms
Cutoff freq: fc = 1/(2πτ) = 16 Hz

PWM freq: 490 Hz (30× above cutoff)
→ Excellent filtering! Ripple < 1%
```

**Filter output:**
```
PWM in:  ▄▄▄  ▄▄▄  ▄▄▄  (Switching at 490 Hz)
         ▌ ▀▀▀▌ ▀▀▀▌ ▀▀

DC out:  ━━━━━━━━━━━━━  (Clean voltage with <50mV ripple)
```

#### 6. Output to EFIS (Dynon D120)

The filtered voltage connects directly to the Dynon fuel inputs:
```
Left output → Dynon "Left Fuel Input" (0-5V range)
Right output → Dynon "Right Fuel Input" (0-5V range)
Common ground → Dynon ground

The Dynon converts this 0-5V signal to gallons using its own
internal calibration table based on your tank geometry.
```

---

## Hardware Requirements

### Main Components

| Component | Quantity | Description | Approx. Cost |
|-----------|----------|-------------|--------------|
| Arduino Nano | 1 | ATmega328P microcontroller | $5 |
| NE555 Timer IC | 2 | Astable oscillator (DIP-8 package) | $1 |
| 8-pin DIP socket | 2 | IC socket for 555 timers | $0.50 |
| LM7805 | 1 | 5V voltage regulator (TO-220) | $0.50 |
| 10kΩ resistor | 2 | 1/4W metal film (R1, R3) | $0.20 |
| 100kΩ resistor | 2 | 1/4W metal film (R2, R4) | $0.20 |
| 1kΩ resistor | 4 | 1/4W metal film (output protection + PWM filter) | $0.40 |
| 330Ω resistor | 1 | 1/4W metal film (LED current limit) | $0.10 |
| 0.01µF capacitor | 2 | Ceramic (555 pin 5 bypass) | $0.20 |
| 10µF capacitor | 4 | Electrolytic 16V (power + PWM filters) | $0.40 |
| 0.1µF capacitor | 4 | Ceramic (decoupling) | $0.40 |
| 1N4001 diode | 1 | Reverse polarity protection | $0.10 |
| LED (5mm) | 1 | Status indicator | $0.20 |
| Pushbuttons | 3 | SPST momentary NO | $1.50 |
| RG-174 coax | 12 feet | Shielded cable for probes | $5 |
| Perfboard | 1 | 10cm × 15cm or larger | $3 |
| Enclosure | 1 | Aluminum (EMI shielding) | $12 |
| Screw terminals | 6 | 2-position blocks | $2 |
| Misc hardware | - | Standoffs, screws, wire | $2 |

**Total Cost: ~$25-30**

### Tools Required

**Essential:**
- Soldering iron (25-40W temperature controlled)
- Solder (60/40 or 63/37 rosin core)
- Wire strippers
- Diagonal cutters (flush cut)
- Multimeter
- Drill and bits (for enclosure)

**Helpful:**
- Oscilloscope or frequency counter (for testing)
- Desoldering pump or wick
- Helping hands or PCB holder
- Heat shrink tubing kit
- Label maker

---

## Circuit Design

### Complete Schematic

```
POWER SUPPLY SECTION:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Aircraft +12V ─[Fuse 1A]─[D1 1N4001]─┬─[LM7805 IN]
                                      │      │
                                   [C 10µF] GND
                                      │      │
                                      │  [LM7805 OUT]─┬─ +5V Rail
                                      │               │
                                     GND           [C 0.1µF]
                                                      │
                                                     GND

LEFT TANK - 555 TIMER #1:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
+5V─┬─[R1 10kΩ]─┬─[R2 100kΩ]─[Left Probe]─GND
    │           │
    │    [NE555 IC #1]
    │    Pin 8,4 ← +5V
    │    Pin 1 ← GND
    │    Pin 2,6,7 ← Junction (R2/Probe)
    │    Pin 5 ─[0.01µF]─ GND
    │    Pin 3 (Output) ─[1kΩ]─ Arduino Pin 2
    │
    └─ (Power connections)

RIGHT TANK - 555 TIMER #2:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
+5V─┬─[R3 10kΩ]─┬─[R4 100kΩ]─[Right Probe]─GND
    │           │
    │    [NE555 IC #2]
    │    Pin 8,4 ← +5V
    │    Pin 1 ← GND
    │    Pin 2,6,7 ← Junction (R4/Probe)
    │    Pin 5 ─[0.01µF]─ GND
    │    Pin 3 (Output) ─[1kΩ]─ Arduino Pin 3
    │
    └─ (Power connections)

ARDUINO CONNECTIONS:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Vin ────── +5V
GND ────── GND
Pin 2 ──── Left 555 Output (interrupt 0)
Pin 3 ──── Right 555 Output (interrupt 1)
Pin 4 ──── EMPTY Button ──┐
Pin 5 ──── FULL Button ───┼─── GND (when pressed)
Pin 6 ──── TANK SEL Button┘
Pin 9 ──── Left PWM Output
Pin 10 ─── Right PWM Output
Pin 13 ─── Status LED ─[330Ω]─ GND

PWM OUTPUT FILTERS:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Arduino Pin 9 ─[1kΩ]─┬─[10µF]─ GND
                      │
                  Left Output to Dynon

Arduino Pin 10 ─[1kΩ]─┬─[10µF]─ GND
                       │
                   Right Output to Dynon
```

### Component Values Explained

**Why R1 = 10kΩ and R2 = 100kΩ?**

These values were chosen to:
1. Give frequency range of 11-34 kHz (good for Arduino measurement)
2. Provide ~50% duty cycle square wave (easier to process)
3. Keep power consumption low (<5mW per timer)
4. Match common resistor values (easy to source)

**Why 0.01µF on pin 5?**

Pin 5 is the control voltage reference inside the 555. This capacitor:
- Filters noise from power supply and EMI
- Prevents false triggering from electrical interference
- Stabilizes the internal voltage reference (1.67V and 3.33V thresholds)
- Has very low impedance at radio frequencies (16Ω at 1 MHz)

**Why 10µF for PWM filter?**

With 1kΩ resistor:
- Time constant τ = 10ms
- Cutoff frequency = 16 Hz
- PWM frequency = 490 Hz (30× above cutoff)
- Results in <1% ripple on output

---

## Software Design

### Code Architecture

The software is organized into clear functional blocks:

```
┌─────────────────────────────────────────────────┐
│                   SETUP()                       │
├─────────────────────────────────────────────────┤
│ • Initialize serial communication              │
│ • Configure pins (inputs/outputs)              │
│ • Attach interrupts for frequency measurement  │
│ • Load calibration from EEPROM                 │
│ • Initialize averaging buffers                 │
│ • Display startup information                  │
└─────────────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────┐
│                   LOOP()                        │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │  Every 1 second:                            │ │
│ │  • Read pulse counts from ISRs              │ │
│ │  • Calculate frequencies (Hz)               │ │
│ │  • Add to averaging buffers                 │ │
│ └─────────────────────────────────────────────┘ │
│                                                 │
│ ┌─────────────────────────────────────────────┐ │
│ │  Every 200ms:                               │ │
│ │  • Calculate averaged frequencies           │ │
│ │  • Convert frequency → PWM value            │ │
│ │  • Output PWM to pins 9 and 10              │ │
│ │  • Print debug info to serial               │ │
│ └─────────────────────────────────────────────┘ │
│                                                 │
│ ┌─────────────────────────────────────────────┐ │
│ │  Continuously:                              │ │
│ │  • Check tank selection button              │ │
│ │  • Check calibration buttons (empty/full)   │ │
│ │  • Handle button hold timing (2 seconds)    │ │
│ │  • Update status LED                        │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### Key Functions

#### Interrupt Service Routines (ISRs)

```cpp
// Called automatically on every rising edge
void countLeftPulse() {
  leftPulseCount++;  // Increment counter
}

void countRightPulse() {
  rightPulseCount++;  // Increment counter
}
```

**Why interrupts?**
- Hardware-driven (CPU doesn't have to poll)
- Zero latency (triggers immediately on edge)
- Can't miss pulses (even if main code is busy)
- Accurate timing (not affected by delays or loops)

#### Frequency Measurement

```cpp
// Every 1 second
noInterrupts();  // Stop counting during read
unsigned long leftCount = leftPulseCount;
leftPulseCount = 0;  // Reset for next second
interrupts();  // Resume counting

leftFrequency = (float)leftCount;  // Frequency in Hz
```

**The measurement window:**
```
Second 0:  Count = 0
           ↓ (Counting pulses...)
Second 1:  Count = 34,286 → Frequency = 34,286 Hz = 34.3 kHz
           Reset count to 0
           ↓ (Counting pulses...)
Second 2:  Count = 34,310 → Frequency = 34,310 Hz = 34.3 kHz
```

#### Averaging Filter

```cpp
float averageSamples(float* samples) {
  float sum = 0;
  for (int i = 0; i < NUM_SAMPLES; i++) {
    sum += samples[i];
  }
  return sum / NUM_SAMPLES;
}
```

**Why average 10 samples?**
- Smooths out fuel slosh in flight
- Reduces noise effects
- Still responsive (10 seconds = fast enough for fuel)
- Simple moving average (no complex filtering needed)

#### Frequency to PWM Conversion

```cpp
uint8_t frequencyToPWM(float frequency, TankCalibration tank) {
  // Boundary conditions
  if (frequency >= tank.emptyFrequency) return 0;    // 0V
  if (frequency <= tank.fullFrequency) return 255;   // 5V
  
  // Linear interpolation
  float fraction = (tank.emptyFrequency - frequency) / 
                   (tank.emptyFrequency - tank.fullFrequency);
  
  int pwm = (int)(fraction * 255.0);
  
  // Constrain and return
  if (pwm < 0) pwm = 0;
  if (pwm > 255) pwm = 255;
  return (uint8_t)pwm;
}
```

**The math explained:**
```
Example:
  emptyFrequency = 34,000 Hz (calibrated empty)
  fullFrequency = 11,000 Hz (calibrated full)
  current = 22,500 Hz (measurement)

Calculate fraction:
  numerator = 34,000 - 22,500 = 11,500
  denominator = 34,000 - 11,000 = 23,000
  fraction = 11,500 / 23,000 = 0.5
  
Convert to PWM:
  pwm = 0.5 × 255 = 127.5 → 127
  
This is exactly half-scale (tank half full)
Output voltage = 127/255 × 5V = 2.49V
```

#### Calibration Storage

```cpp
void saveCalibration() {
  EEPROM.put(EEPROM_MAGIC_ADDR, EEPROM_MAGIC_VALUE);
  EEPROM.put(EEPROM_LEFT_EMPTY_ADDR, leftTank.emptyFrequency);
  EEPROM.put(EEPROM_LEFT_FULL_ADDR, leftTank.fullFrequency);
  EEPROM.put(EEPROM_RIGHT_EMPTY_ADDR, rightTank.emptyFrequency);
  EEPROM.put(EEPROM_RIGHT_FULL_ADDR, rightTank.fullFrequency);
}
```

**EEPROM memory map:**
```
Address 0-1:   Magic value (0xCAFE) - indicates valid data
Address 4-7:   Left tank empty frequency
Address 8-11:  Left tank full frequency
Address 12-15: Right tank empty frequency
Address 16-19: Right tank full frequency

Total: 20 bytes used
Lifespan: 100,000 write cycles (decades of use)
```

---

## Assembly Instructions

### Step-by-Step Build Process

**Build order (most efficient):**

1. ✓ Prepare perfboard and plan layout
2. ✓ Install IC sockets and Arduino headers
3. ✓ Create +5V and GND power rails
4. ✓ Build power supply section (LM7805, caps, diode)
5. ✓ Build left 555 timer circuit
6. ✓ Build right 555 timer circuit
7. ✓ Install PWM output filters (R+C)
8. ✓ Install button connections
9. ✓ Install status LED
10. ✓ Install screw terminals for external connections
11. ✓ Visual inspection and continuity testing
12. ✓ Power-up test (no ICs installed)
13. ✓ Install 555 ICs and Arduino
14. ✓ Upload code and test
15. ✓ Install in enclosure

### Recommended Perfboard Layout

```
Top view (10cm × 15cm perfboard):

+─────────────────────────────────────────────────+
│                                                 │
│  [Power Supply Section]                        │
│  LM7805, caps, diode                           │
│  ┌──── +5V Rail (red wire) ─────────────────┐  │
│  │                                           │  │
│  │  [Left 555]     [Arduino]     [Right 555] │  │
│  │    IC + R/C       Nano          IC + R/C  │  │
│  │                                           │  │
│  │  Pin 9 ─[1kΩ]─┬─[10µF]─ GND              │  │
│  │               │                           │  │
│  │              OUT to Left Screw Terminal   │  │
│  │                                           │  │
│  │  Pin 10 ─[1kΩ]─┬─[10µF]─ GND             │  │
│  │                │                          │  │
│  │               OUT to Right Screw Terminal │  │
│  │                                           │  │
│  └──── GND Rail (black wire) ────────────────┘  │
│                                                 │
│  [Screw Terminals for External Connections]    │
│  Power | L Probe | R Probe | L Out | R Out     │
│                                                 │
│  [Button Connections]                          │
│  Pin 4  Pin 5  Pin 6  (pulled to GND)         │
│                                                 │
+─────────────────────────────────────────────────+
```

### Critical Assembly Notes

**1. IC Orientation**
```
555 Timer (DIP-8):
  
  Pin 1 indicator (notch or dot)
        ↓
    ┌─────┐
    │●    │  Pin 1 (GND) is near the notch/dot
    │  5  │  
    │  5  │  Notch at top = Pin 1 at top-left
    │  5  │  
    └─────┘
    
Orient both 555s the same direction for easier wiring!
```

**2. Capacitor Polarity**
```
Electrolytic capacitors have polarity!

  ┌───┐
  │ + │ ← Longer lead = positive
  │   │
  │ - │ ← Shorter lead, stripe on body = negative
  └───┘
  
Get this wrong = capacitor explodes! (not kidding)
Check twice before soldering!
```

**3. Power Rail Connections**
```
Good practice:
  - Make rails thick (use bare wire or multiple paths)
  - Solder every 5th hole for good conductivity
  - Verify continuity along entire rail
  - No voltage drop should be measurable

Test with multimeter:
  - +5V at LM7805 output
  - +5V at far end of rail (should be same)
  - If voltage drops > 0.1V, improve rail connection
```

---

## Calibration

### Pre-Flight Calibration Procedure

**Important:** Calibrate with ACTUAL FUEL in YOUR tanks!

#### Left Tank Calibration

1. **Prepare:**
   - Connect to aircraft power
   - Open serial monitor (115200 baud)
   - Verify system shows "Currently selected: LEFT TANK"

2. **Calibrate Empty:**
   ```
   - Drain left tank completely
   - Wait 5 minutes for fuel to settle
   - Press and hold EMPTY button
   - LED turns on (confirming button press)
   - Hold for full 2 seconds
   - LED blinks 3 times rapidly
   - Serial shows: "LEFT TANK - EMPTY CALIBRATION SET"
   - Release button
   ```

3. **Calibrate Full:**
   ```
   - Fill left tank to capacity (measure with dipstick)
   - Wait 5 minutes for fuel to settle
   - Press and hold FULL button
   - LED turns on (confirming button press)
   - Hold for full 2 seconds
   - LED blinks 5 times rapidly
   - Serial shows: "LEFT TANK - FULL CALIBRATION SET"
   - Release button
   ```

#### Right Tank Calibration

1. **Select Right Tank:**
   ```
   - Press TANK SELECT button once
   - LED blinks 2 times (indicating RIGHT selected)
   - Serial shows: ">>> SELECTED: RIGHT TANK <<<"
   ```

2. **Calibrate Empty:**
   ```
   - Drain right tank completely
   - Wait 5 minutes for fuel to settle
   - Press and hold EMPTY button for 2 seconds
   - LED blinks 3 times (confirmation)
   ```

3. **Calibrate Full:**
   ```
   - Fill right tank to capacity
   - Wait 5 minutes for fuel to settle
   - Press and hold FULL button for 2 seconds
   - LED blinks 5 times (confirmation)
   ```

#### Verification

After calibration, verify readings:

```
Serial Monitor Output:

L: 34250 Hz → PWM:0 (0.00V) | R: 33890 Hz → PWM:0 (0.00V)
                ↑ Empty tanks should show 0V

Add 5 gallons to left tank...

L: 28500 Hz → PWM:64 (1.25V) | R: 33890 Hz → PWM:0 (0.00V)
                ↑ 1/4 full ≈ 1.25V

Fill both tanks completely...

L: 11250 Hz → PWM:255 (5.00V) | R: 11470 Hz → PWM:255 (5.00V)
                ↑ Full tanks should show 5V
```

Use dipstick to verify intermediate levels!

### Calibration Storage

**Where it's saved:**
- Arduino EEPROM (non-volatile memory)
- Survives power cycles
- ~100,000 write cycles lifespan
- Can be re-calibrated anytime

**To reset calibration:**
- Just recalibrate! New values overwrite old ones
- No special "reset" procedure needed

---

## Testing

### Bench Testing (Before Installation)

#### Test 1: Power Supply

```
Equipment: Multimeter

1. Apply 12V to power input
2. Measure at LM7805 output: Should read 5.0V ±0.1V
3. Measure at +5V rail: Should read 5.0V ±0.1V
4. Measure at Arduino Vin: Should read 5.0V ±0.1V
5. Check for hot components (indicates short)

Pass criteria: Stable 5.0V, no hot parts
```

#### Test 2: 555 Timer Operation

```
Equipment: Oscilloscope or frequency counter

1. Temporarily connect 220pF test capacitor
2. Power up circuit
3. Measure pin 3 of left 555: Should see square wave ~30-35 kHz
4. Measure pin 3 of right 555: Should see square wave ~30-35 kHz
5. Remove test capacitor

Pass criteria: Clean square wave, frequency in expected range
```

#### Test 3: Arduino Frequency Measurement

```
Equipment: Serial monitor

1. Upload code to Arduino
2. Open serial monitor (115200 baud)
3. Observe frequency readings
4. Should see stable readings around 30-35 kHz
5. Touch probe connection: frequency should change

Pass criteria: Stable frequency readings displayed
```

#### Test 4: PWM Output

```
Equipment: Multimeter on DC voltage

1. Observe PWM output at Arduino pins 9 and 10
2. With test capacitor: Should read ~2.5V (midscale)
3. Short probe to ground (simulate high capacitance)
4. Voltage should increase toward 5V
5. Remove short, voltage returns to ~2.5V

Pass criteria: Voltage changes with capacitance
```

#### Test 5: Filtered Output

```
Equipment: Multimeter, oscilloscope (optional)

1. Measure DC voltage after RC filter
2. Should match PWM measurement
3. With oscilloscope: Check ripple < 100mV
4. Verify smooth transitions as capacitance changes

Pass criteria: Clean DC output, low ripple
```

### Flight Testing

**Ground tests:**
1. Verify 0V with empty tanks
2. Verify 5V with full tanks
3. Compare to dipstick at 1/4, 1/2, 3/4 levels
4. Document any discrepancies

**First flight:**
1. Note initial fuel reading
2. Monitor for erratic behavior
3. Land and verify against dipstick
4. Adjust calibration if needed

**Long-term monitoring:**
- Monthly comparison to dipstick
- Annual re-verification of calibration
- Log any anomalies

---

## Troubleshooting

### Common Issues and Solutions

#### No Power / LED Not Blinking

**Symptoms:** System completely dead, no LED

**Check:**
- [ ] Aircraft power connected?
- [ ] Fuse good?
- [ ] Diode installed correctly? (band toward LM7805)
- [ ] LM7805 getting 12V on input pin?
- [ ] LM7805 outputting 5V?

**Fix:** Verify power path with multimeter

---

#### Frequency Reading Zero

**Symptoms:** Serial monitor shows 0 Hz for one or both tanks

**Check:**
- [ ] 555 IC installed correctly? (Pin 1 orientation)
- [ ] 555 getting +5V on pin 8?
- [ ] 555 pin 4 connected to +5V? (reset must be high)
- [ ] Fuel probe connected?
- [ ] Arduino interrupt working?

**Fix:** 
```
Test 555 output directly:
  - Measure pin 3 with oscilloscope
  - Should see square wave
  - If not, check 555 power and connections
```

---

#### Erratic / Jumping Readings

**Symptoms:** Frequency jumps around wildly

**Check:**
- [ ] Pin 5 bypass capacitor installed? (0.01µF)
- [ ] Ground connections solid?
- [ ] Probe wire shielded?
- [ ] Shield grounded at converter end only?
- [ ] Routing away from ignition wires?

**Fix:**
```
Improve filtering:
  - Verify 0.01µF cap on pin 5
  - Increase NUM_SAMPLES in code (try 20)
  - Add ferrite bead on probe wire
  - Improve grounding
```

---

#### Output Stuck at 0V or 5V

**Symptoms:** One tank always reads empty or always full

**Check:**
- [ ] Calibration done for that tank?
- [ ] Correct tank selected during calibration?
- [ ] Frequency actually changing?
- [ ] PWM output working? (measure at Arduino pin)
- [ ] RC filter working? (check resistor and capacitor)

**Fix:**
```
Recalibrate:
  1. Select correct tank
  2. Drain tank → EMPTY button
  3. Fill tank → FULL button
  4. Verify serial output shows calibration
```

---

#### Both Tanks Show Same Reading

**Symptoms:** Left and right always identical

**Check:**
- [ ] Two separate 555 circuits built?
- [ ] Probe wires not crossed?
- [ ] Arduino reading both pins 2 AND 3?
- [ ] Two separate PWM outputs?
- [ ] Two separate RC filters?

**Fix:**
```
Verify signal path:
  - Left probe → Left 555 → Pin 2 → Pin 9 → Left output
  - Right probe → Right 555 → Pin 3 → Pin 10 → Right output
  - No cross-connections
```

---

#### Buttons Don't Work

**Symptoms:** Pressing buttons does nothing

**Check:**
- [ ] Buttons wired to correct pins? (4, 5, 6)
- [ ] Buttons connect to GND when pressed?
- [ ] Holding for full 2 seconds?
- [ ] LED responding?
- [ ] Serial monitor showing button presses?

**Fix:**
```
Test buttons:
  - Open serial monitor
  - Press TANK SELECT
  - Should see "SELECTED: LEFT/RIGHT"
  - If not, check button wiring
```

---

## Performance Specifications

### Measurement Specifications

| Parameter | Value |
|-----------|-------|
| Input capacitance range | 50 pF to 5000 pF |
| Typical probe range | 150-600 pF |
| Frequency range | 11-70 kHz |
| Measurement resolution | 1 Hz (0.02 pF equivalent) |
| Update rate | 5 Hz (200ms) |
| Averaging window | 10 samples (10 seconds) |

### Output Specifications

| Parameter | Value |
|-----------|-------|
| Output voltage range | 0-5V DC |
| Resolution | 8-bit (256 steps) |
| Step size (20 gal tank) | 0.078 gallons/step |
| Output ripple | < 50mV (< 1%) |
| Output impedance | ~1kΩ |
| Output accuracy | ±0.5% of full scale |

### Electrical Specifications

| Parameter | Value |
|-----------|-------|
| Input voltage | 12-14V DC (aircraft power) |
| Operating voltage | 5V regulated |
| Current consumption | < 50mA |
| Power consumption | < 0.25W |
| Operating temperature | -20°C to +70°C |
| Storage temperature | -40°C to +85°C |

### Accuracy and Precision

**System accuracy:**
```
Theoretical resolution: 0.078 gallons (20-gal tank)
Calibration accuracy: ±0.5% of full scale = ±0.1 gallons
Total system accuracy: ±0.2 gallons (better than dipstick!)

For comparison:
  Typical fuel sender: ±1-2% (±0.2-0.4 gallons)
  Dipstick measurement: ±0.5 gallons (human reading error)
  
This system exceeds typical aircraft fuel sender accuracy!
```

---

## Safety Considerations

### Electrical Safety

⚠️ **Reverse polarity protection:** D1 diode prevents damage from backwards connection

⚠️ **Fused input:** 1A fuse protects against shorts

⚠️ **Current limiting:** All outputs have series resistors

⚠️ **Grounding:** Enclosure grounded to aircraft structure

### Installation Safety

⚠️ **No adjustment in flight:** All calibration done on ground

⚠️ **Redundant measurement:** Always use dipstick as backup

⚠️ **Professional review:** Have A&P or DAR inspect installation

⚠️ **Documentation:** Record all calibration values in aircraft logs

### Operational Safety

⚠️ **This is NOT your only fuel measurement!**
- Always dip tanks before flight
- Use fuel totalizer as backup
- Monitor fuel burn rate
- Plan with adequate reserves

⚠️ **Experimental aircraft only**
- This design is for amateur-built experimental aircraft
- Not certified for production aircraft
- Builder assumes all responsibility

⚠️ **Regular verification**
- Monthly: Compare to dipstick
- Annual: Re-verify calibration
- After maintenance: Check all connections

### Failure Modes

**What happens if it fails?**

| Failure | Result | Mitigation |
|---------|--------|------------|
| Total power loss | No fuel indication | Dipstick, totalizer |
| One tank fails | Other tank still works | Dipstick for failed tank |
| Erratic reading | Unstable indication | Use totalizer, dipstick |
| Stuck reading | Fixed value shown | Obvious to pilot, use backup |

**The system is designed to fail safely:**
- No failure mode gives dangerously wrong reading
- Erratic readings are obvious to the pilot
- Multiple backup methods always available

---

## Bill of Materials (BOM)

### Complete Parts List with Sources

**Electronics Components:**

| Qty | Part Number | Description | Supplier | Price |
|-----|-------------|-------------|----------|-------|
| 1 | Arduino Nano (clone) | ATmega328P board | Amazon/eBay | $5.00 |
| 2 | NE555P | 555 Timer IC DIP-8 | Mouser 595-NE555P | $0.50 |
| 2 | - | 8-pin DIP socket | Mouser 517-4808-3000-CP | $0.25 |
| 1 | LM7805 | 5V regulator TO-220 | Mouser 511-L7805CV | $0.50 |
| 2 | - | 10kΩ 1/4W 5% | Mouser (any) | $0.10 |
| 2 | - | 100kΩ 1/4W 5% | Mouser (any) | $0.10 |
| 4 | - | 1kΩ 1/4W 5% | Mouser (any) | $0.20 |
| 1 | - | 330Ω 1/4W 5% | Mouser (any) | $0.05 |
| 2 | - | 0.01µF ceramic | Mouser (any) | $0.10 |
| 4 | - | 10µF 16V electrolytic | Mouser (any) | $0.20 |
| 4 | - | 0.1µF ceramic | Mouser (any) | $0.20 |
| 1 | 1N4001 | Rectifier diode | Mouser 512-1N4001 | $0.10 |
| 1 | - | 5mm LED red | Mouser (any) | $0.20 |
| 3 | - | Pushbutton SPST NO | Mouser (any) | $1.50 |

**Mechanical Parts:**

| Qty | Part Number | Description | Supplier | Price |
|-----|-------------|-------------|----------|-------|
| 1 | - | Perfboard 10×15cm | Amazon | $3.00 |
| 1 | - | Aluminum enclosure | Hammond 1590DD | $12.00 |
| 6 | - | Screw terminal 2-pos | Mouser | $2.00 |
| 10 ft | RG-174/U | Coax cable | DX Engineering | $5.00 |
| - | - | Standoffs, screws | Amazon hardware kit | $2.00 |
| - | - | Wire 22 AWG (colors) | Amazon | $3.00 |

**Total: ~$30**

---

## License

MIT License

Copyright (c) 2026 [Your Name]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---

## Additional Resources

**Documentation Files:**
- `555_CIRCUIT_EXPLANATION.md` - Detailed 555 timer circuit theory
- `PWM_FILTER_GUIDE.md` - PWM output filter design
- `ASSEMBLY_GUIDE.md` - Complete assembly instructions
- `DUAL_TANK_GUIDE.md` - Dual tank specific information
- `dual_tank_wiring_diagram.html` - Interactive wiring diagrams

**Arduino Code:**
- `555_dual_tank_PWM.ino` - Complete Arduino sketch

**Online Resources:**
- Van's Air Force Forums: vansairforce.net
- Arduino Frequency Measurement: arduino.cc
- 555 Timer Calculator: ohmslawcalculator.com/555-astable-calculator

---

## Acknowledgments

This design builds on decades of homebuilt aircraft experience and proven electronic design principles:

- **555 Timer:** Invented by Hans Camenzind at Signetics (1972)
- **Capacitive fuel sensing:** Used in aircraft since the 1960s
- **Arduino platform:** Making embedded systems accessible to all
- **RV Builder Community:** Decades of shared knowledge

Special thanks to the Van's Aircraft builder community for inspiration and feedback.

---

## Contact and Support

**For questions, issues, or improvements:**
- Open an issue on GitHub
- Post on Van's Air Force forums
- Contact: [your email]

**Before asking for help, please:**
1. Read the troubleshooting section
2. Check your wiring against the diagrams
3. Verify power supply voltages
4. Test 555 outputs with oscilloscope
5. Provide serial monitor output

**This project is provided as-is for educational purposes. The builder assumes all responsibility for construction, testing, installation, and operation. Always follow applicable aviation regulations and consult with qualified professionals.**

---

## Version History

**v1.0** (2026-01-04)
- Initial release
- Dual tank support
- PWM output with RC filters
- Button-based calibration
- EEPROM storage

---

**Build safely, fly safely!** ✈️
